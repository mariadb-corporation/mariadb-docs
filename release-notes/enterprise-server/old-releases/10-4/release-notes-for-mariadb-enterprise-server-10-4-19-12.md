# Release Notes for MariaDB Enterprise Server 10.4.19-12

This twelfth release of [MariaDB Enterprise Server](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/mariadb-enterprise-server/README.md) 10.4 is a maintenance release. This release includes a variety of fixes.

MariaDB Enterprise Server 10.4.19-12 was released on 2021-06-14.

## Fixed Security Vulnerabilities

| CVE (with [cve.org](https://github.com/mariadb-corporation/docs-release-notes/blob/test/mariadb-enterprise-server-release-notes/mariadb-enterprise-server-10-4/cve.org) link) | CVSS base score |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------- |
| [CVE-2021-2166](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-2166)                                                                                                 | 4.9             |
| [CVE-2021-2154](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-2154)                                                                                                 | 4.9             |

## Notable Changes

* New function [ST\_DISTANCE\_SPHERE()](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/geometry-constructors/geometry-relations/st_distance_sphere) calculates the spherical distance between two geometries (point or multipoint) on a sphere. ([MDEV-13467](https://jira.mariadb.org/browse/MDEV-13467))
* Galera updated to 26.4.8
* Issue deprecation warnings for [innodb\_checksum\_algorithm](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb/innodb-system-variables#innodb_checksum_algorithm) values `none, innodb, strict_none, strict_innodb` ([MDEV-25106](https://jira.mariadb.org/browse/MDEV-25106))
* [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) avoids unnecessary rollbacks with streaming replication. ([MDEV-25553](https://jira.mariadb.org/browse/MDEV-25553))
* Improved TLS/SSL error reporting. ([MDEV-21730](https://jira.mariadb.org/browse/MDEV-21730))

## Issues Fixed

### Can result in data loss

* [ALTER TABLE](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-definition/alter/alter-table) fails to rename a column in [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) table and causes server to crash. [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) table is not accessible after restart. ([MDEV-24763](https://jira.mariadb.org/browse/MDEV-24763))
* Table corruption ER\_NO\_SUCH\_TABLE\_IN\_ENGINE or ER\_CRASHED\_ON\_USAGE after ALTER on [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) table with foreign key. ([MDEV-24532](https://jira.mariadb.org/browse/MDEV-24532))
* [MariaDB Enterprise Backup](../../10-4/broken-reference/) deletes the current source file after a No space left on device error, before exiting. Only the incomplete target file is still available. ([MDEV-25221](https://jira.mariadb.org/browse/MDEV-25221))
* Possible corruption in online [ALTER TABLE](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-definition/alter/alter-table) for [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) with ROW\_FORMAT=REDUNDANT ([MDEV-24730](https://jira.mariadb.org/browse/MDEV-24730))
* [DELETE HISTORY](https://github.com/mariadb-corporation/docs-release-notes/blob/test/mariadb-enterprise-server-release-notes/mariadb-enterprise-server-10-4/DELETE-HISTORY/README.md) may delete current data on [system-versioned table](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-structure/temporal-tables/system-versioned-tables). ([MDEV-25468](https://jira.mariadb.org/browse/MDEV-25468))
* Encrypted transactional [Aria](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/aria) tables remain corrupt after crash recovery, automatic repair does not work. ([MDEV-17913](https://jira.mariadb.org/browse/MDEV-17913))

### Can result in a hang or crash

* Possible hang when [KILL CONNECTION](https://github.com/mariadb-corporation/docs-release-notes/blob/test/mariadb-enterprise-server-release-notes/mariadb-enterprise-server-10-4/KILL-CONNECTION/README.md) or [KILL QUERY](https://github.com/mariadb-corporation/docs-release-notes/blob/test/mariadb-enterprise-server-release-notes/mariadb-enterprise-server-10-4/KILL-QUERY/README.md) is used with [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) and a multi-master setup ([MDEV-18874](https://jira.mariadb.org/browse/MDEV-18874))
* Possible memory corruption with [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) when inserting values bigger than 4096 bytes into variable-length fields ([BLOB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/data-types/string-data-types/blob), [TEXT](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/data-types/string-data-types/text), [VARCHAR](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/data-types/string-data-types/varchar), and related types). ([MDEV-24978](https://jira.mariadb.org/browse/MDEV-24978))
* [innodb\_flush\_method=O\_DIRECT](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb/innodb-system-variables#innodb_flush_method) fails on compressed tables. ([MDEV-25121](https://jira.mariadb.org/browse/MDEV-25121))
* Server crashes in `check_grant` upon invoking function with [userstat](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/ha-and-performance/optimization-and-tuning/query-optimizations/statistics-for-optimizing-queries/user-statistics#userstat) enabled. ([MDEV-25242](https://jira.mariadb.org/browse/MDEV-25242))
* [MariaDB Client](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/mariadb/README.md) crashes when [--default-character-set](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-management/starting-and-stopping-mariadb/mariadbd-options) is set and [--character-sets-dir](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-management/variables-and-modes/server-system-variables#character_sets_dir) is undefined. ([MDEV-24879](https://jira.mariadb.org/browse/MDEV-24879))
* Possible Server crash when [dropping a table](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-definition/drop/drop-table). Only seen when using a table space per table and if the tablespace size is increased at the time of the drop. ([MDEV-20648](https://jira.mariadb.org/browse/MDEV-20648))
* Possible server hang with [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) and indexed virtual columns after an error with [UPDATE](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-manipulation/changing-deleting-data/update), [INSERT](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-manipulation/inserting-loading-data/insert), [REPLACE](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-manipulation/changing-deleting-data/replace) on virtual columns. ([MDEV-24786](https://jira.mariadb.org/browse/MDEV-24786))
* [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) conflict resolution issues. ([MDEV-24923](https://jira.mariadb.org/browse/MDEV-24923))
* Index count mismatch due to aborted `FULLTEXT INDEX` ([MDEV-25200](https://jira.mariadb.org/browse/MDEV-25200))
* [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) node crashes when inserting a row into a table that contains a virtual column and does not have a primary key. ([MDEV-25047](https://jira.mariadb.org/browse/MDEV-25047))
* Server crashes when [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) fails to add a new index on a new virtual column and a concurrent connection executes a query that accesses the freed virtual column. ([MDEV-24971](https://jira.mariadb.org/browse/MDEV-24971))
* [EXISTS](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-manipulation/selecting-data/joins-subqueries/subqueries/subqueries-and-exists) subquery with correlation in `ON` expression crashes. ([MDEV-25407](https://jira.mariadb.org/browse/MDEV-25407))
* Server crashes in `row_undo_mod_clust_low` upon rollback of read-only transaction. ([MDEV-25457](https://jira.mariadb.org/browse/MDEV-25457))
* Server crashes on the second execution of a stored procedure when the stored procedure uses an invalid multi-table [UPDATE](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-manipulation/changing-deleting-data/update) statement to update a view. ([MDEV-24823](https://jira.mariadb.org/browse/MDEV-24823))
* [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) startup hangs when a recovered transaction exists for the [mysql.innodb\_index\_stats](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-management/starting-and-stopping-mariadb/mariadbd-options) or [mysql.innodb\_table\_stats](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-management/starting-and-stopping-mariadb/mariadbd-options) system tables and a DDL transaction needs to be rolled back. ([MDEV-25503](https://jira.mariadb.org/browse/MDEV-25503))
* Server crashes when [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) tries to fetch data from table containing a `FULLTEXT INDEX` and the table's tablespace was discarded. ([MDEV-25536](https://jira.mariadb.org/browse/MDEV-25536))
* Server crashes on [SHOW TABLES](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/administrative-sql-statements/show/show-tables) when a WHERE condition references a derived table. ([MDEV-21603](https://jira.mariadb.org/browse/MDEV-21603))
* Potential hang in [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) purge when virtual indexed columns exist. (MENT-1203)
* After [DROP INDEX](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-definition/drop/drop-index) or [CREATE INDEX](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-definition/create/create-index), change buffer entries for secondary indexes are lost on [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) restart. (MENT-1217)
* Crash with nested table value constructors. ([MDEV-22786](https://jira.mariadb.org/browse/MDEV-22786))
* Server crashes when an aggregate function is called on a table value constructed with the [VALUES()](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-functions/secondary-functions/miscellaneous-functions/values-value) or [VALUE()](https://github.com/mariadb-corporation/docs-release-notes/blob/test/mariadb-enterprise-server-release-notes/mariadb-enterprise-server-10-4/VALUE/README.md) functions. ([MDEV-24919](https://jira.mariadb.org/browse/MDEV-24919))
* Server crashes when a [SELECT](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-manipulation/selecting-data/select) statement has a subquery that references a table value constructed with the [VALUES()](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-functions/secondary-functions/miscellaneous-functions/values-value) or [VALUE()](https://github.com/mariadb-corporation/docs-release-notes/blob/test/mariadb-enterprise-server-release-notes/mariadb-enterprise-server-10-4/VALUE/README.md) functions. ([MDEV-24910](https://jira.mariadb.org/browse/MDEV-24910))
* Server crashes when a [SELECT](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-manipulation/selecting-data/select) statement has an [IN()](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-structure/operators/comparison-operators/in) clause that references the `UNION` of two table values constructed with the VALUES() or VALUE() functions. ([MDEV-24840](https://jira.mariadb.org/browse/MDEV-24840))
* Possible memory corruption or crash if a table definition is evicted from the cache during a transaction commit. ([MDEV-24811](https://jira.mariadb.org/browse/MDEV-24811))
* Server crashes when the [DEFAULT()](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-functions/secondary-functions/information-functions/default) function is called on a [BLOB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/data-types/string-data-types/blob) column. ([MDEV-22703](https://jira.mariadb.org/browse/MDEV-22703), [MDEV-24958](https://jira.mariadb.org/browse/MDEV-24958), [MDEV-24942](https://jira.mariadb.org/browse/MDEV-24942))
* Server crashes when a [SELECT](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-manipulation/selecting-data/select) statement queries an [Information Schema](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/system-tables/information-schema) table and uses a JOIN ([MDEV-24929](https://jira.mariadb.org/browse/MDEV-24929))
* Server crash in optimize\_schema\_tables\_memory\_usage after [SELECT](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-manipulation/selecting-data/select) from [information\_schema.innodb\_sys\_columns](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/system-tables/information-schema/information-schema-tables/information-schema-innodb-tables/information-schema-innodb_sys_columns-table) ([MDEV-24868](https://jira.mariadb.org/browse/MDEV-24868))
* Server crashes when a `FULLTEXT INDEX` is added to an [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) table and the tablespace for the table was previously discarded. ([MDEV-25070](https://jira.mariadb.org/browse/MDEV-25070))
* Server crashes when the optimizer incorrectly removes a `GROUP BY` from a subquery, because the column is specified in both the [SELECT](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-manipulation/selecting-data/select) list and the `GROUP BY` list. ([MDEV-24925](https://jira.mariadb.org/browse/MDEV-24925))
* Server crashes when a [SELECT](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-manipulation/selecting-data/select) statement has a subquery in the FROM clause that contains a `GROUP BY` clause and multiple indexes are used: one index is used to resolve the `GROUP BY` clause and another index is used for the LATERAL DERIVED optimization. ([MDEV-23723](https://jira.mariadb.org/browse/MDEV-23723))
* Crash with [CREATE VIEW](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/views/create-view) .. [SELECT](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-manipulation/selecting-data/select) with non-existing field in `ON` condition. ([MDEV-25206](https://jira.mariadb.org/browse/MDEV-25206))
* Server crashes due to an assertion with multi-master workloads on [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) when [log\_slave\_updates](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/ha-and-performance/standard-replication/replication-and-binary-log-system-variables) is disabled and a conflicting transaction is aborted for a higher priority transaction. ([MDEV-24954](https://jira.mariadb.org/browse/MDEV-24954))
* Possible hang when [KILL CONNECTION](https://github.com/mariadb-corporation/docs-release-notes/blob/test/mariadb-enterprise-server-release-notes/mariadb-enterprise-server-10-4/KILL-CONNECTION/README.md) or [KILL QUERY](https://github.com/mariadb-corporation/docs-release-notes/blob/test/mariadb-enterprise-server-release-notes/mariadb-enterprise-server-10-4/KILL-QUERY/README.md) is used with [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) and a multi-master setup. ([MDEV-24967](https://jira.mariadb.org/browse/MDEV-24967))
* Possible memory corruption when streaming replication is used for [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md). ([MDEV-24964](https://jira.mariadb.org/browse/MDEV-24964))
* [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) node crashes when the [mysql.user](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/system-tables/the-mysql-database-tables/mysql-user-table) system table is truncated. ([MDEV-24865](https://jira.mariadb.org/browse/MDEV-24865))
* [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) node crashes when [wsrep\_provider\_options](https://app.gitbook.com/s/3VYeeVGUV4AMqrA3zwy7/reference/galera-cluster-system-variables#wsrep_provider_options) set to `NULL` ([MDEV-24856](https://jira.mariadb.org/browse/MDEV-24856))
* Server crashes when a column is dropped from an [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) table with the `INSTANT` algorithm. ([MDEV-25057](https://jira.mariadb.org/browse/MDEV-25057))
* [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) node crashes when `CREATE TABLE t1 ( .. ) SELECT .. FROM t2` is executed where `t1` is an [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) table and `t2` is a non-InnoDB table. ([MDEV-21697](https://jira.mariadb.org/browse/MDEV-21697))
* [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) node crashes when an uncommitted transaction is replicated using streaming replication while [wsrep\_on](https://app.gitbook.com/s/3VYeeVGUV4AMqrA3zwy7/reference/galera-cluster-system-variables#wsrep_on) is enabled and the transaction is committed while [wsrep\_on](https://app.gitbook.com/s/3VYeeVGUV4AMqrA3zwy7/reference/galera-cluster-system-variables#wsrep_on) is disabled. ([MDEV-25226](https://jira.mariadb.org/browse/MDEV-25226))
* Server crashes with [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) when a non-InnoDB table is locked with the [LOCK TABLE](https://github.com/mariadb-corporation/docs-release-notes/blob/test/mariadb-enterprise-server-release-notes/mariadb-enterprise-server-10-4/LOCK-TABLE/README.md) statement and a concurrent connections executes [CREATE VIEW](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/views/create-view) that references the same table. ([MDEV-22227](https://jira.mariadb.org/browse/MDEV-22227))
* Possible server crash after failing instant [InnoDB ALTER](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-definition/alter/alter-table) on secondary indexes. ([MDEV-25360](https://jira.mariadb.org/browse/MDEV-25360))
* Server crashes in `thd_clear_errors()` ([MDEV-23542](https://jira.mariadb.org/browse/MDEV-23542))
* [MariaDB Enterprise Backup](../../10-4/broken-reference/) crashes when called without parameters on Windows. ([MDEV-24106](https://jira.mariadb.org/browse/MDEV-24106))
* Server crashes during crash recovery when freed pages exist in the tablespace of an encrypted [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) table. Also affects \[\[[mariadb-backup|MariaDB Enterprise Backup](../../10-4/broken-reference/)]] during [--prepare](https://github.com/mariadb-corporation/docs-server/blob/test/release-notes/enterprise-server/10-4/broken-reference/README.md) ([MDEV-24792](https://jira.mariadb.org/browse/MDEV-24792))
* [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) conflict resolution issues. ([MDEV-25579](https://jira.mariadb.org/browse/MDEV-25579), [MDEV-24980](https://jira.mariadb.org/browse/MDEV-24980), [MDEV-25378](https://jira.mariadb.org/browse/MDEV-25378))

### Can result in unexpected behavior

* SUM`column from a derived table returns invalid values. ([MDEV-23291](https://jira.mariadb.org/browse/MDEV-23291))`
* [CAST('0e1111111111' AS DECIMAL(38,0))](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-functions/string-functions/cast) returns an incorrect result. ([MDEV-24790](https://jira.mariadb.org/browse/MDEV-24790))
* Incorrect behavior of [SET STATEMENT](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/administrative-sql-statements/set-commands/set-statement) when it is executed as a prepared statement. ([MDEV-24860](https://jira.mariadb.org/browse/MDEV-24860))
* Query returns a [ER\_BAD\_FIELD\_ERROR](https://github.com/mariadb-corporation/docs-server/blob/test/release-notes/enterprise-server/10-4/broken-reference/README.md) error when a subquery contains a `JOIN` with an `ON` clause that references an outer column. ([MDEV-25002](https://jira.mariadb.org/browse/MDEV-25002))
* Query returns a [ER\_BAD\_FIELD\_ERROR](https://github.com/mariadb-corporation/docs-server/blob/test/release-notes/enterprise-server/10-4/broken-reference/README.md) error when a Common Table Expression (CTE) contains a `UNION` ([MDEV-24597](https://jira.mariadb.org/browse/MDEV-24597))
* Query returns wrong result when the [MIN()](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-functions/aggregate-functions/min) or [MAX()](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-functions/aggregate-functions/max) aggregate functions are used and the aggregated column is indexed. ([MDEV-25112](https://jira.mariadb.org/browse/MDEV-25112))
* Wrong result (extra rows and wrong values) with incremental block nested loop hash. ([MDEV-21104](https://jira.mariadb.org/browse/MDEV-21104))
* Query returns wrong results when a JOIN is evaluated using the Block Nested Loop Hash (BLNH) optimization with a compound index. ([MDEV-24767](https://jira.mariadb.org/browse/MDEV-24767))
* Server fails to start using `mysqld_multi` with `mysqld_safe` options. ([MDEV-21039](https://jira.mariadb.org/browse/MDEV-21039))
* Duplicate key may be generated during [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) configuration change. ([MDEV-24853](https://jira.mariadb.org/browse/MDEV-24853))
* State snapshot transfer (SST) for [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) using \[\[[mariadb-backup|MariaDB Enterprise Backup](../../10-4/broken-reference/)]] fails when the --log-bin option was set on the command-line with no value at server startup. ([MDEV-24903](https://jira.mariadb.org/browse/MDEV-24903))
* Race condition between persistent statistics and [RENAME TABLE](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-definition/rename-table) or TRUNCATE ([MDEV-25051](https://jira.mariadb.org/browse/MDEV-25051))
* Race condition between [ANALYZE TABLE](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/table-statements/analyze-table) and `STATS_AUTO_RECALC` ([MDEV-10682](https://jira.mariadb.org/browse/MDEV-10682))
* Incorrect message about field length is written to the [error log](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-management/server-monitoring-logs/error-log) when [CHECK TABLE](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/table-statements/check-table) is executed on an [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) table. ([MDEV-24748](https://jira.mariadb.org/browse/MDEV-24748))
* No error is returned when the optimizer removes a redundant part of a subquery that contains an unknown table alias. For example, if the optimizer removes a redundant `GROUP BY` clause from an [IN()](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-structure/operators/comparison-operators/in) subquery, unknown table aliases in the redundant part are ignored. ([MDEV-23449](https://jira.mariadb.org/browse/MDEV-23449))
* Selectivity shown with [EXPLAIN](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/administrative-sql-statements/analyze-and-explain-statements/explain) in field `"filter"` is incorrect for [BIT](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/data-types/numeric-data-types/bit) columns. ([MDEV-22583](https://jira.mariadb.org/browse/MDEV-22583))
* Histogram statistics are used even with optimizer\_use\_condition\_selectivity=3 ([MDEV-19474](https://jira.mariadb.org/browse/MDEV-19474))
* [EXPLAIN](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/administrative-sql-statements/analyze-and-explain-statements/explain) shows nonsensical value for `key_len` with `type=index` ([MDEV-11172](https://jira.mariadb.org/browse/MDEV-11172))
* SSL connection fails when server and client certs are signed by same CA. ([MDEV-23740](https://jira.mariadb.org/browse/MDEV-23740))
* Wrong function name in error messages upon [ST\_GeomFromGeoJSON](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/geometry-constructors/geometry-constructors/st_geomfromgeojson) call. ([MDEV-25272](https://jira.mariadb.org/browse/MDEV-25272))
* \[\[[mariadb-backup|MariaDB Enterprise Backup](../../10-4/broken-reference/)]] fails [--prepare](https://github.com/mariadb-corporation/docs-server/blob/test/release-notes/enterprise-server/10-4/broken-reference/README.md) on large backup. ([MDEV-24197](https://jira.mariadb.org/browse/MDEV-24197))
* State snapshot transfer (SST) for [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) using \[\[[mariadb-backup|MariaDB Enterprise Backup](../../10-4/broken-reference/)]] fails when the password for the backup user is set via the `MYSQL_PWD` environment variable. ([MDEV-25321](https://jira.mariadb.org/browse/MDEV-25321))
* State snapshot transfer (SST) for [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) using \[\[[mariadb-backup|MariaDB Enterprise Backup](../../10-4/broken-reference/)]] fails when the [--innodb](https://github.com/mariadb-corporation/docs-server/blob/test/release-notes/enterprise-server/10-4/broken-reference/README.md) option was set on the command-line at server startup. ([MDEV-25328](https://jira.mariadb.org/browse/MDEV-25328))
* An extra warning is returned when the [EXPLAIN EXTENDED](https://github.com/mariadb-corporation/docs-release-notes/blob/test/mariadb-enterprise-server-release-notes/mariadb-enterprise-server-10-4/EXPLAIN-EXTENDED/README.md) statement is executed in a prepared statement. ([MDEV-25108](https://jira.mariadb.org/browse/MDEV-25108))
* Complex query in stored procedure returns wrong results. ([MDEV-25182](https://jira.mariadb.org/browse/MDEV-25182))
* [ALTER TABLE](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-definition/alter/alter-table) wrongly checks for field's default value if `AFTER` is used. ([MDEV-25403](https://jira.mariadb.org/browse/MDEV-25403))
* Incorrect name resolution for subqueries in ON expressions. ([MDEV-25362](https://jira.mariadb.org/browse/MDEV-25362))
* When [FLUSH LOGS](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/administrative-sql-statements/flush-commands/flush) is executed, a race condition between [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) group commit and binary log rotation causes the old binary log file to become obsolete before the [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) group commit has been written to it. ([MDEV-24526](https://jira.mariadb.org/browse/MDEV-24526))
* \[\[[mariadb-backup|MariaDB Enterprise Backup](../../10-4/broken-reference/)]] logs an error instead of a warning when it reads an invalid log block checksum during a [--backup](https://github.com/mariadb-corporation/docs-server/blob/test/release-notes/enterprise-server/10-4/broken-reference/README.md). ([MDEV-25456](https://jira.mariadb.org/browse/MDEV-25456))
* Rows are wrongly omitted when an [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) index is read using Multiversion Concurrency Control (MVCC). ([MDEV-25459](https://jira.mariadb.org/browse/MDEV-25459))
* [SELECT](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-manipulation/selecting-data/select) aborts after failed [REPLACE](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-manipulation/changing-deleting-data/replace) into table with virtual column. ([MDEV-24583](https://jira.mariadb.org/browse/MDEV-24583))
* [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) fails to fetch index type when index mismatch happens. ([MDEV-22928](https://jira.mariadb.org/browse/MDEV-22928))
* [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) silently enables [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) Monitor output and never disables it when a `wsrep` slave thread tries to perform a brute-force (BF) kill, but fails due to a long lock wait. ([MDEV-25319](https://jira.mariadb.org/browse/MDEV-25319))
* [RENAME TABLE](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-definition/rename-table) causes `"Ignoring data file ... with space ID xxxx, since the redo log references ... with space ID xxxx."` for \[\[[mariadb-backup|MariaDB Enterprise Backup](../../10-4/broken-reference/)]]. ([MDEV-25568](https://jira.mariadb.org/browse/MDEV-25568))
* The Replication Heartbeat binary log event (`Heartbeat_log_event`) uses 4 bytes to store the log position within the current binary log file, so the log position overflows when the binary log file size exceeds 4 GB. ([MDEV-16146](https://jira.mariadb.org/browse/MDEV-16146))
* [InnoDB](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb) spatial indexes miss large geometry fields. (MENT-1205)
* Table alias from previous statement interferes with later commands. (MENT-1200)
* [EXPLAIN](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/administrative-sql-statements/analyze-and-explain-statements/explain) statement does not show details about sub-queries when the primary table is a table value constructed with the [VALUES()](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-functions/secondary-functions/miscellaneous-functions/values-value) or [VALUE()](https://github.com/mariadb-corporation/docs-release-notes/blob/test/mariadb-enterprise-server-release-notes/mariadb-enterprise-server-10-4/VALUE/README.md) functions. ([MDEV-24936](https://jira.mariadb.org/browse/MDEV-24936))
* `JOIN` of a materialized derived table returns wrong result when the split\_materialized optimization is enabled. ([MDEV-25128](https://jira.mariadb.org/browse/MDEV-25128))
* Uninitialized value upon `CREATE .. SELECT .. VALUE` and variety of resulting errors with different engines. ([MDEV-24710](https://jira.mariadb.org/browse/MDEV-24710))
* Dropping primary key column from a [system-versioned table](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-structure/temporal-tables/system-versioned-tables) always fails with Error 1072 ([MDEV-24690](https://jira.mariadb.org/browse/MDEV-24690))
* `ALTER TABLE .. ADD COLUMN .. AS ROW START` returns misleading [ER\_VERS\_DUPLICATE\_ROW\_START\_END](https://github.com/mariadb-corporation/docs-server/blob/test/release-notes/enterprise-server/10-4/broken-reference/README.md) error. ([MDEV-25172](https://jira.mariadb.org/browse/MDEV-25172))
* Unexpected [ER\_DUP\_ENTRY](https://github.com/mariadb-corporation/docs-server/blob/test/release-notes/enterprise-server/10-4/broken-reference/README.md) error when the Primary Key column is dropped from a [system-versioned table](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-structure/temporal-tables/system-versioned-tables). ([MDEV-25327](https://jira.mariadb.org/browse/MDEV-25327))
* [slave\_compressed\_protocol](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/ha-and-performance/standard-replication/replication-and-binary-log-system-variables) doesn't work properly with semi-sync replication. ([MDEV-24773](https://jira.mariadb.org/browse/MDEV-24773))
* Sequence created by one connection remains invisible to another. ([MDEV-24545](https://jira.mariadb.org/browse/MDEV-24545))
* `routine_definition` in [information\_schema.routines](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/system-tables/information-schema/information-schema-tables/information-schema-routines-table) loses tablename if it starts with an \_ and is not backticked. ([MDEV-25501](https://jira.mariadb.org/browse/MDEV-25501))
* `JOIN` of a derived table using an aggregation function returns incorrect results. (MENT-1210)
* Server temporarily consumes extra 4 GB of memory every time the [INFORMATION\_SCHEMA.OPTIMIZER\_TRACE](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/system-tables/information-schema/information-schema-tables/information-schema-optimizer_trace-table) table is queried. ([MDEV-24975](https://jira.mariadb.org/browse/MDEV-24975))
* [ALTER TABLE](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/data-definition/alter/alter-table) not replicated with [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md). ([MDEV-24956](https://jira.mariadb.org/browse/MDEV-24956))
* The setting [sql\_safe\_updates](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-management/variables-and-modes/server-system-variables#sql_safe_updates) can result in unexpected warnings when using [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md). ([MDEV-21402](https://jira.mariadb.org/browse/MDEV-21402))
* The [SET PASSWORD](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/account-management-sql-statements/set-password) statement fails with [ER\_MUST\_CHANGE\_PASSWORD](https://github.com/mariadb-corporation/docs-server/blob/test/release-notes/enterprise-server/10-4/broken-reference/README.md) when the statement is executed in a prepared statement and the user's password is expired. ([MDEV-25197](https://jira.mariadb.org/browse/MDEV-25197))
* [MariaDB Enterprise Cluster FLUSH SSL](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) command doesn't reload wsrep cert. (MENT-1089)
* State snapshot transfer (SST) for [MariaDB Enterprise Cluster](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera-cluster/README.md) using [mariadb-dump](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/clients-and-utilities/backup-restore-and-import-clients/mariadb-dump) causes shutdown of donor node to fail. ([MDEV-25423](https://jira.mariadb.org/browse/MDEV-25423))
* [MariaDB Enterprise Spider](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/spider) returns `The connect info 'tab' for table is too long` when creating a Spider Table. ([MDEV-22265](https://jira.mariadb.org/browse/MDEV-22265))
* `garbd` has connection issues. (MENT-1168)
* [Galera](https://github.com/mariadb-corporation/docs-release-notes/blob/test/en/galera/README.md) startup log shows [mysql.server\_audit\_filters](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/system-tables/the-mysql-database-tables/mysql-servers-table) data load error when enabling server audit log through configuration file. (MENT-1196)

### Related to install and upgrade

* Missing `libsepol` dependency on SLES 12 and SLES 15. (MENT-1163)
* `caching_sha2_password.so` isn't included in Debian packages. ([MDEV-24728](https://jira.mariadb.org/browse/MDEV-24728))

## Interface Changes

* [mariadb-backup](../../10-4/broken-reference/) [--innodb-force-recovery](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-usage/storage-engines/innodb/innodb-system-variables#innodb_force_recovery) command-line option added
* mariadb\_repo\_setup --skip-check-installed command-line option added
* [ST\_DISTANCE\_SPHERE](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/reference/sql-statements/geometry-constructors/geometry-relations/st_distance_sphere) function added

## Platforms

In alignment with the [enterprise lifecycle](https://app.gitbook.com/o/diTpXxF5WsbHqTReoBsS/s/aEnK0ZXmUbJzqQrTjFyb/~/changes/32/mariadb-enterprise-server-release-notes/enterprise-server-lifecycle), MariaDB Enterprise Server 10.4.19-12 is provided for:

* CentOS 7 (x86\_64)
* Debian 10 (x86\_64, ARM64)
* Microsoft Windows (x86\_64) (MariaDB Enterprise Cluster excluded)
* Red Hat Enterprise Linux 7 (x86\_64)
* Red Hat Enterprise Linux 8 (x86\_64, ARM64)
* Rocky Linux 8 (x86\_64, ARM64 Red Hat Enterprise Linux 8 packages)
* SUSE Linux Enterprise Server 12 (x86\_64)
* SUSE Linux Enterprise Server 15 (x86\_64, ARM64)
* Ubuntu 20.04 (x86\_64, ARM64)

Some components of MariaDB Enterprise Server might not support all platforms. For additional information, see [MariaDB Corporation Engineering Policies".](https://mariadb.com/engineering-policies).

## Installation Instructions

* [MariaDB Enterprise Server 10.4](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/architecture/topologies/single-node-topologies/enterprise-server)
* [Enterprise Cluster Topology with MariaDB Enterprise Server ](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/architecture/topologies/galera-cluster)[10](https://app.gitbook.com/s/0pSbu5DcMSW4KwAkUcmX/maxscale-architecture/mariadb-enterprise-spider-topologies/federated-mariadb-enterprise-spider-topology)[.4](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/architecture/topologies/galera-cluster)
* [Primary/Replica Topology with MariaDB Enterprise Server 10.4](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/architecture/topologies/primary-replica)
* [Enterprise Spider Sharded Topology with MariaDB Enterprise Server 10.4](https://app.gitbook.com/s/0pSbu5DcMSW4KwAkUcmX/maxscale-architecture/mariadb-enterprise-spider-topologies/sharded-mariadb-enterprise-spider-topology)
* [Enterprise Spider Federated Topology with MariaDB Enterprise Server 10.4](https://app.gitbook.com/s/0pSbu5DcMSW4KwAkUcmX/maxscale-architecture/mariadb-enterprise-spider-topologies/federated-mariadb-enterprise-spider-topology)

## Upgrade Instructions

* [Upgrade to MariaDB Enterprise Server 10.4](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-management/install-and-upgrade-mariadb/upgrading/upgrading-to-unmaintained-mariadb-releases/upgrading-from-mariadb-10-4-to-mariadb-10-5)
* [Upgrade from MariaDB Community Server to MariaDB Enterprise Server 10.4](https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/server-management/install-and-upgrade-mariadb/upgrading/upgrading-between-major-mariadb-versions)

{% include "https://app.gitbook.com/s/SsmexDFPv2xG2OTyO5yV/~/reusable/pNHZQXPP5OEz2TgvhFva/" %}

{% @marketo/form formid="4316" formId="4316" %}
